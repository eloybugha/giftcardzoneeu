<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PopOpen Debug — Test Mode</title>
<style>
  body{font:600 16px system-ui,Segoe UI,Roboto,Arial;background:#071023;color:#e6f0ff;min-height:100vh;display:grid;place-items:center;padding:24px}
  .card{width:100%;max-width:720px;background:#071526;border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.04)}
  h1{margin:0 0 8px;font-size:20px}
  p{margin:0 0 12px;color:#a9c0dd}
  .row{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px}
  button{padding:10px 14px;border-radius:10px;border:0;font-weight:800;cursor:pointer;background:linear-gradient(90deg,#ffd54a,#facc15);color:#061219}
  .small{padding:8px 10px;font-size:14px}
  .log{background:#021022;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);font-family:monospace;font-size:13px;color:#9fd4ff;white-space:pre-wrap;max-height:260px;overflow:auto}
  label{display:block;font-size:13px;color:#9fb7db;margin-bottom:6px}
  input[type=text]{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:#061428;color:#e6f0ff}
  .info{font-size:13px;color:#9fb7db;margin-top:8px}
</style>
</head>
<body>
  <div class="card">
    <h1>PopOpen Debug — Quick Test</h1>
    <p>One-click tests to see if Adsterra / Monetag opens are allowed by your browser. Follow steps below and paste the report back to me.</p>

    <label>Adsterra link (primary)</label>
    <input id="adLink" type="text" value="https://www.effectivegatecpm.com/b3tf3q5h?key=d30075f9a8298d2e723defde10af4e33"/>

    <label style="margin-top:8px">Monetag link (fallback)</label>
    <input id="moLink" type="text" value="https://otieu.com/4/4203960"/>

    <div class="row" style="margin-top:12px">
      <button id="testAd" class="small">Test Adsterra (new tab)</button>
      <button id="testMo" class="small">Test Monetag (new tab)</button>
      <button id="testBoth" class="small">Test Primary → Fallback</button>
      <button id="clear" class="small">Clear Log</button>
      <button id="copy" class="small">Copy Report</button>
    </div>

    <div class="info">Instructions:
      <ol>
        <li>Open this page in <b>incognito</b> on the device you use for ads testing (mobile + desktop recommended).</li>
        <li>Press <b>Test Adsterra</b> once. Observe whether a new tab opens. Check the log below.</li>
        <li>If blocked, press <b>Test Monetag</b>. If both blocked, allow pop-ups for this site and re-test.</li>
        <li>Then press <b>Test Primary → Fallback</b> to simulate our real flow.</li>
        <li>Copy the report and paste here so I can read the exact result.</li>
      </ol>
    </div>

    <div style="margin-top:12px">
      <div class="log" id="log">Log ready — perform a test to begin.</div>
    </div>
  </div>

<script>
(function(){
  const logEl = document.getElementById("log");
  function log(...args){
    const t = new Date().toISOString();
    const msg = args.map(a => (typeof a === "object" ? JSON.stringify(a) : String(a))).join(" ");
    logEl.textContent = `${logEl.textContent}\n[${t}] ${msg}`;
    logEl.scrollTop = logEl.scrollHeight;
    console.log(...args);
  }

  function tryOpen(url){
    try {
      const w = window.open(url, "_blank", "noopener,noreferrer");
      return !!w;
    } catch(e) {
      return false;
    }
  }

  // Buttons
  document.getElementById("testAd").addEventListener("click", (e)=>{
    e.preventDefault();
    const url = document.getElementById("adLink").value.trim();
    log("TEST AD: trying window.open()", url);
    const ok = tryOpen(url);
    log("RESULT AD open returned:", ok ? "OPENED" : "BLOCKED (null)");
    // Note: some browsers return a Window object but still block network requests — check dashboard
  });

  document.getElementById("testMo").addEventListener("click", (e)=>{
    e.preventDefault();
    const url = document.getElementById("moLink").value.trim();
    log("TEST MO: trying window.open()", url);
    const ok = tryOpen(url);
    log("RESULT MO open returned:", ok ? "OPENED" : "BLOCKED (null)");
  });

  document.getElementById("testBoth").addEventListener("click", (e)=>{
    e.preventDefault();
    const primary = document.getElementById("adLink").value.trim();
    const fallback = document.getElementById("moLink").value.trim();
    log("FLOW TEST: Attempt primary → fallback");
    let ok = false;
    try {
      ok = tryOpen(primary);
    } catch(_) { ok = false; }
    log("Primary open returned:", ok ? "OPENED" : "BLOCKED");
    setTimeout(()=>{
      if(ok){
        log("Primary likely opened successfully — check new tab for Adsterra page load and your Adsterra dashboard for impressions.");
      } else {
        log("Primary blocked — trying fallback open()");
        let ok2 = tryOpen(fallback);
        log("Fallback open returned:", ok2 ? "OPENED" : "BLOCKED");
        if(!ok2){
          log("Both blocked — last resort same-tab redirect to fallback (will navigate away).");
          // Do not auto-redirect unless user confirms — show button to allow manual redirect
          log("If you want to force same-tab fallback now, click the 'Force Same-Tab Fallback' button added below.");
          addForceButton(fallback);
        } else {
          log("Fallback opened — check Monetag dashboard and impressions.");
        }
      }
    }, 80);
  });

  function addForceButton(url){
    if(document.getElementById("forceBtn")) return;
    const btn = document.createElement("button");
    btn.id = "forceBtn";
    btn.textContent = "Force Same-Tab Fallback";
    btn.style.marginTop = "10px";
    btn.onclick = function(){
      log("User forced same-tab redirect to:", url);
      location.href = url;
    };
    document.querySelector(".card").appendChild(btn);
  }

  document.getElementById("clear").addEventListener("click", ()=>{ logEl.textContent = "Log cleared."; });
  document.getElementById("copy").addEventListener("click", ()=>{
    navigator.clipboard && navigator.clipboard.writeText(logEl.textContent).then(()=>{ alert("Report copied — paste it here."); }).catch(()=>{ alert("Copy failed — select and copy the log manually."); });
  });

  // Init header
  log("Ready. Use the buttons to test popups / opens. Use incognito for clean test.");
})();
</script>
</body>
</html>
