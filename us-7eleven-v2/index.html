  <!doctype html>
<html lang="tl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Spin & Unlock</title>
<style>
  :root { --bg:#0b1220; --card:#121a2b; --txt:#e6ecff; --muted:#9bb0ff; --accent:#5eead4; }
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--txt);font:500 16px/1.5 system-ui,-apple-system,Segoe UI,Roboto}
  .wrap{min-height:100dvh;display:grid;place-items:center;padding:24px}
  .card{width:100%;max-width:440px;background:var(--card);border:1px solid #1c2742;border-radius:20px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  h1{margin:0 0 8px;font-size:22px}
  p.lead{margin:0 0 16px;color:var(--muted)}
  .wheelBox{display:grid;place-items:center;margin:10px 0 14px}
  .wheel{position:relative;width:280px;aspect-ratio:1;border-radius:50%;border:10px solid #0f1931;background:
    conic-gradient(#3b82f6 0 45deg,#22d3ee 0 90deg,#a78bfa 0 135deg,#34d399 0 180deg,#f59e0b 0 225deg,#ef4444 0 270deg,#10b981 0 315deg,#eab308 0 360deg)}
  .center{position:absolute;inset:50% auto auto 50%;transform:translate(-50%,-50%);width:110px;height:110px;background:#0f1931;color:#fff;border-radius:50%;display:grid;place-items:center;border:6px solid #0b1220;text-align:center;padding:6px}
  .pin{position:absolute;left:50%;top:-18px;transform:translateX(-50%);width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:18px solid #ffd43b;filter:drop-shadow(0 2px 0 #0005)}
  .btn{width:100%;border:0;border-radius:12px;padding:14px 16px;font-weight:700;background:linear-gradient(180deg,#53ffd6,#23bfa6);color:#06131a;cursor:pointer}
  .btn[disabled]{opacity:.55;cursor:not-allowed}
  .note{margin-top:10px;font-size:13px;color:#9db3ff;}
  .result{margin:10px 0 6px;font-weight:700;text-align:center}
  .hide{display:none}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Spin the Wheel</h1>
    <p class="lead">Paikutin mo para ma-unlock ang best offer ngayong araw.</p>

    <div class="wheelBox">
      <div class="wheel" id="wheel">
        <div class="pin"></div>
        <div class="center"><small>Tap to</small><div style="font-size:18px;font-weight:800">SPIN</div></div>
      </div>
    </div>

    <div id="result" class="result hide">Result: ‚Äî</div>
    <button id="continueBtn" class="btn hide">Continue</button>
    <p class="note">Tip: Pagkatapos mag-spin, pindutin ang ‚ÄúContinue‚Äù para magbukas ang offer. If blocked, we‚Äôll auto-retry fallbacks.</p>
  </div>
</div>

<script>
/* ----- HARD GUARD: bawal mag-init nang dalawang beses ----- */
if (!window.__SPIN_INIT__) {
  window.__SPIN_INIT__ = true;

  // === LINKS (Primary ‚Üí Fallbacks) ===
  const PRIMARY_LINK   = "https://www.effectivegatecpm.com/qng7ic9mmn?key=7aafa190a2f78bc6cb6fd084e1fa9c4c"; // Adsterra
  const FALLBACK_LINKS = [
    "https://traffserve.com/?a=XXXX&c=YYYY",        // Monetag smartlink (palitan mo)
    // "https://s.click.aliexpress.com/e/XXXXXXXX", // (optional) AliExpress
  ];

  // === Elements ===
  const wheel = document.getElementById("wheel");
  const resultBox = document.getElementById("result");
  const continueBtn = document.getElementById("continueBtn");

  // === State ===
  let hasSpun = false;   // para di mag-doble ang spin
  let hasFired = false;  // para di mag-doble ang window.open chain

  // === Helpers ===
  function pickPrize() {
    // 8 slices @ 45deg each; babagay sa conic-gradient sa CSS
    const prizes = ["üî• Bonus","üéÅ Gift","‚≠ê Special","üí• Extra","üéâ Win","üíé Premium","ü™ô Coins","‚úÖ Unlock"];
    const idx = Math.floor(Math.random()*prizes.length);
    return { label: prizes[idx], index: idx };
  }

  function tryOpen(url){
    try{
      const win = window.open(url, "_blank", "noopener,noreferrer");
      return !!win;
    }catch(e){ return false; }
  }

  function openWithFallback(){
    if (hasFired) return;
    hasFired = true;

    const opened = tryOpen(PRIMARY_LINK);
    if (opened) return;

    let i = 0;
    const step = () => {
      if (i >= FALLBACK_LINKS.length) return;
      const ok = tryOpen(FALLBACK_LINKS[i++]);
      if (!ok) setTimeout(step, 350);
    };
    setTimeout(step, 300);
  }

  // === Spin Logic (CSS rotate) ===
  function spinOnce(){
    if (hasSpun) return;            // one spin only
    hasSpun = true;

    const { label, index } = pickPrize();
    // target angle: center ng slice sa pin (pin nasa top). Each slice = 45deg.
    const slice = 45;
    const targetSliceCenter = index * slice + slice/2;
    const fullTurns = 6 * 360;      // smooth na paikot
    const finalDeg = fullTurns + (360 - targetSliceCenter) + (Math.random()*10-5);

    wheel.style.transition = "transform 3s cubic-bezier(.17,.67,.22,1)";
    wheel.style.transform = `rotate(${finalDeg}deg)`;

    // reveal result + button after animation
    setTimeout(() => {
      resultBox.textContent = "Result: " + label;
      resultBox.classList.remove("hide");
      continueBtn.classList.remove("hide");
    }, 3000);
  }

  // === Events (single binding lang) ===
  wheel.addEventListener("click", spinOnce, { once:true });
  continueBtn.addEventListener("click", openWithFallback);

  // Safety: kung may ibang script na nagre-render muli ng HTML,
  // hindi magdo-double ang init dahil sa window.__SPIN_INIT__ guard.
}
</script>
</body>
</html>
