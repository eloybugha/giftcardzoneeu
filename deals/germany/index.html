<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Germany Deals • Pure Affiliate Gallery</title>
  <meta name="description" content="Auto-scan gallery with per-item affiliate links. No popups, no forced redirects." />
  <link rel="canonical" href="https://giftcardzoneeu.com/deals/germany/"/>
  <meta property="og:title" content="Germany Deals" />
  <meta property="og:description" content="Auto-scan images • Per-item links • Lightbox preview." />
  <meta property="og:type" content="website" />
  <style>
    :root{--bg:#0b0e14;--card:#111623;--text:#e8eefc;--muted:#9fb0d1;--gap:14px;--radius:16px;--shadow:0 6px 24px rgba(0,0,0,.25);--cta:#2b5cff;--cta-t:#fff;--grid:minmax(220px,1fr)}
    *{box-sizing:border-box}html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font:500 15px/1.5 system-ui,Segoe UI,Roboto,Arial}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1200px;margin:0 auto;padding:24px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px}
    .title{font-size:20px;font-weight:800;letter-spacing:.2px}
    .hint{color:var(--muted);font-size:13px}
    .bar{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 18px}
    .btn{background:var(--cta);color:var(--cta-t);padding:10px 14px;border-radius:12px;font-weight:700;box-shadow:var(--shadow);border:1px solid rgba(255,255,255,.06);cursor:pointer}
    .btn.alt{background:#192034;color:#d9e3ff;border:1px solid #26304b}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,var(--grid));gap:var(--gap)}
    .card{background:var(--card);border:1px solid #1a2132;border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;min-height:260px;display:flex;flex-direction:column;justify-content:space-between}
    .card a.imgwrap{display:block;line-height:0}
    .card img{width:100%;height:220px;object-fit:cover;display:block;background:#0e1220}
    .row{display:flex;align-items:center;justify-content:space-between;padding:12px 12px 14px}
    .meta{color:var(--muted);font-size:12px}
    .footer{margin:28px 0 10px;color:var(--muted);font-size:12px}
    .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.86);display:none;align-items:center;justify-content:center;padding:24px;z-index:9999}
    .lightbox.open{display:flex}
    .lightbox img{max-width:96vw;max-height:90vh;border-radius:12px;box-shadow:0 8px 40px rgba(0,0,0,.6)}
    .x{position:fixed;top:14px;right:14px;background:#101523;border:1px solid #223050;color:#dfe7ff;padding:8px 10px;border-radius:10px;z-index:10000}
    @media (max-width:600px){ .card img{height:180px} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="title">Germany Deals</div>
        <div class="hint">Pure affiliate gallery · per-item links</div>
      </div>
      <a class="btn alt" href="/">Home</a>
    </header>

    <div class="bar">
      <a class="btn" href="https://s.click.aliexpress.com/e/_YOUR_AFF" rel="nofollow noopener">AliExpress Germany</a>
      <a class="btn" href="https://amzn.to/YOUR_TAG" rel="nofollow noopener">Amazon Germany</a>
      <a class="btn alt" href="https://giftcardzoneeu.com/go/global-router/">Open Global Apps</a>
    </div>

    <div class="grid" id="grid" aria-live="polite"></div>

    <div class="footer">
      Auto-scans from <code>/assets/deals/germany/</code>. Per-item links from <code>links.json</code> (optional). If missing, Shop uses default global link.
    </div>
  </div>

  <div class="lightbox" id="box" role="dialog" aria-modal="true">
    <button class="x" id="xBtn" aria-label="Close">Close ✕</button>
    <img alt="Preview" id="boxImg" />
  </div>

  <script>
    // Repo + paths
    const OWNER = "eloybugha";
    const REPO  = "giftcardzoneeu";
    const PATH  = "assets/deals/germany";
    const ASSET_BASE  = "/assets/deals/germany/";
    const LINKS_FILE  = ASSET_BASE + "links.json"; // optional
    const DEFAULT_URL = "https://s.click.aliexpress.com/e/_YOUR_AFF"; // fallback if item not in links.json

    const grid = document.querySelector("#grid");
    const box  = document.querySelector("#box");
    const boxImg = document.querySelector("#boxImg");

    function cardTemplate(filename, i, url){
      const src   = ASSET_BASE + filename;
      const title = `Deal #${i+1}`;
      const href  = url || DEFAULT_URL; // <-- ALWAYS clickable now
      return `
        <article class="card" data-file="${encodeURIComponent(filename)}" data-index="${i}">
          <a class="imgwrap" href="${href}" target="_blank" rel="nofollow noopener">
            <img loading="lazy" decoding="async" src="${src}" alt="${title}">
          </a>
          <div class="row">
            <div class="meta">${title}</div>
            <div style="display:flex;gap:8px">
              <button class="btn alt preview-btn" data-file="${encodeURIComponent(filename)}" aria-label="Preview ${title}">Preview</button>
              <a class="btn shop-btn" href="${href}" target="_blank" rel="nofollow noopener">Shop</a>
            </div>
          </div>
        </article>
      `;
    }

    function bindLightbox(){
      grid.addEventListener("click",(e)=>{
        const btn = e.target.closest(".preview-btn");
        if(!btn) return;
        e.preventDefault();
        const file = decodeURIComponent(btn.dataset.file || "");
        if(!file) return;
        boxImg.src = ASSET_BASE + file;
        box.classList.add("open");
      });
      document.querySelector("#xBtn").onclick = ()=>{ box.classList.remove("open"); boxImg.src=""; };
      box.addEventListener("click",(e)=>{ if(e.target===box){ box.classList.remove("open"); boxImg.src=""; }});
      document.addEventListener("keydown",(e)=>{ if(e.key==="Escape"){ box.classList.remove("open"); boxImg.src=""; }});
    }

    async function fetchImages(){
      const api = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${PATH}`;
      const r = await fetch(api, {cache:"no-store"});
      if(!r.ok) throw new Error("GitHub API error (images)");
      const data = await r.json();
      return data.filter(x => x.type==="file" && /\.(jpe?g|png|webp|gif)$/i.test(x.name)).map(x=>x.name);
    }

    async function fetchLinks(){
      try{
        const r = await fetch(LINKS_FILE, {cache:"no-store"});
        if(!r.ok) return {};
        const data = await r.json();
        // allow simple string or {url:"..."} format
        const map = {};
        for(const [k,v] of Object.entries(data)){
          map[k] = typeof v === "string" ? v : (v && v.url ? v.url : undefined);
        }
        return map;
      }catch{ return {}; }
    }

    async function main(){
      bindLightbox();
      try{
        const [files, map] = await Promise.all([fetchImages(), fetchLinks()]);
        files.sort((a,b)=> a.localeCompare(b, undefined, {numeric:true}));
        grid.innerHTML = files.map((f,i)=> cardTemplate(f,i, map[f])).join("");
      }catch(e){
        console.warn(e);
        grid.innerHTML = `<div class="hint">Could not load gallery. Try again with ?v=${Date.now().toString().slice(-4)}</div>`;
      }
    }
    main();
  </script>
</body>
</html>
