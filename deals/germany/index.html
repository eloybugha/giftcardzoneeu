<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Germany Deals • Auto Redirect</title>
  <meta name="description" content="Mixed Germany deals with auto-detected brand redirects via router." />

  <link rel="canonical" href="https://giftcardzoneeu.com/deals/germany/" />
  <meta property="og:title" content="Germany Deals" />
  <meta property="og:description" content="Auto-scan images • Auto-brand redirect • Lazy-loaded grid." />
  <meta property="og:type" content="website" />

  <style>
    :root{
      --bg:#0b0e14; --card:#111623; --text:#e8eefc; --muted:#9fb0d1; --ring:#2b5cff;
      --gap:14px; --radius:16px; --shadow:0 6px 24px rgba(0,0,0,.25);
      --cta:#2b5cff; --cta-t:#fff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji;
      background:linear-gradient(180deg,#0b0e14,#0f1320); color:var(--text);
    }
    .wrap{max-width:1100px;margin:32px auto;padding:0 16px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
    h1{font-size:22px;margin:0}
    .muted{color:var(--muted);font-size:14px}

    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:var(--gap)}
    @media(min-width:680px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    @media(min-width:980px){.grid{grid-template-columns:repeat(4,minmax(0,1fr))}}

    .card{
      position:relative; display:block; background:var(--card); border-radius:16px; overflow:hidden;
      box-shadow:var(--shadow); text-decoration:none; color:inherit; transition:transform .18s ease;
    }
    .card:focus-visible{outline:2px solid var(--ring); outline-offset:2px}
    .card:hover{transform:translateY(-2px)}
    .thumb{
      width:100%; aspect-ratio:4/5; object-fit:cover; display:block;
      background:linear-gradient(90deg,#101725,#0d1320,#101725); background-size:200% 100%;
      animation:shimmer 1.6s infinite linear;
    }
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

    .badge{
      position:absolute; left:10px; bottom:10px; padding:6px 10px; border-radius:999px;
      background:rgba(0,0,0,.55); backdrop-filter:blur(4px); font-size:12px
    }
    .cta{
      position:absolute; right:10px; bottom:10px; padding:6px 10px; border-radius:999px;
      background:var(--cta); color:var(--cta-t); font-size:12px; font-weight:600;
    }
    .brand{
      position:absolute; left:10px; top:10px; padding:4px 8px; border-radius:8px;
      background:rgba(0,0,0,.55); font-size:11px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Gallery</h1>
      <div class="muted" id="counter">Loading…</div>
    </header>

    <div id="gallery" class="grid" aria-live="polite"></div>
  </div>

  <script>
    // ===== CONFIG =====
    const OWNER = "eloybugha";
    const REPO  = "giftcardzoneeu";
    const DIR   = "assets/deals/germany";    // GitHub path to scan
    const BASE  = "/assets/deals/germany/";  // public path
    const ROUTER = "/go/global-router/";     // your redirect page
    const DEFAULT_BRAND = "aliexpress";
    const SUBID = "de-grid";                 // tracking tag

    // Brand detection rules (filename keywords -> brand)
    const BRAND_RULES = [
      { brand: "amazon",      keys: ["amazon","amz"] },
      { brand: "zalando",     keys: ["zalando"] },
      { brand: "mediamarkt",  keys: ["mediamarkt","media-markt","mmarkt"] },
      { brand: "ebay",        keys: ["ebay"] },
      { brand: "ikea",        keys: ["ikea"] },
      { brand: "adidas",      keys: ["adidas"] },
      { brand: "hm",          keys: ["hm","h&m"] },
      { brand: "aliexpress",  keys: ["ali","aliexpress","aexpress","a-e"] }, // keep last so others win first
    ];

    function detectBrand(filename){
      const s = filename.toLowerCase();
      for(const rule of BRAND_RULES){
        if(rule.keys.some(k => s.includes(k))) return rule.brand;
      }
      return DEFAULT_BRAND;
    }

    // Lazy loader
    const io = ("IntersectionObserver" in window) ? new IntersectionObserver((entries,obs)=>{
      for(const e of entries){
        if(e.isIntersecting){
          const img = e.target; img.src = img.dataset.src; obs.unobserve(img);
        }
      }
    }, {rootMargin:"200px"}) : null;

    async function loadImagesFromGitHub(){
      try{
        const api = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${DIR}`;
        const res = await fetch(api, {headers:{'Accept':'application/vnd.github+json'}});
        if(!res.ok) throw new Error("GitHub API error " + res.status);
        const files = await res.json();

        const exts = [".jpg",".jpeg",".png",".webp",".gif"];
        const imgs = files
          .filter(f => f.type === "file" && exts.some(x => f.name.toLowerCase().endsWith(x)))
          .map(f => f.name)
          .sort();

        render(imgs);
      }catch(err){
        console.error(err);
        document.getElementById("counter").textContent = "Could not load images.";
      }
    }

    function render(files){
      const gallery = document.getElementById("gallery");
      const counter = document.getElementById("counter");
      gallery.innerHTML = "";
      files.forEach((name, idx)=>{
        const brand = detectBrand(name);
        // Build router URL
        const url = `${ROUTER}?geo=de&brand=${encodeURIComponent(brand)}&img=${encodeURIComponent(name)}&subid=${encodeURIComponent(SUBID)}`;

        const a = document.createElement("a");
        a.className = "card";
        a.href = url;
        a.target = "_blank";
        a.rel = "nofollow sponsored noopener";
        a.setAttribute("aria-label", `Open ${brand} deal ${idx+1}`);

        const img = document.createElement("img");
        img.className = "thumb";
        img.loading = "lazy";
        img.alt = name;
        img.dataset.src = BASE + name;
        img.onerror = ()=> img.style.opacity = .25;

        if(io) io.observe(img); else img.src = img.dataset.src;

        const brandTag = document.createElement("span");
        brandTag.className = "brand";
        brandTag.textContent = brand;

        const badge = document.createElement("span");
        badge.className = "badge";
        badge.textContent = `#${idx+1}`;

        const cta = document.createElement("span");
        cta.className = "cta";
        cta.textContent = "Shop →";

        a.appendChild(img);
        a.appendChild(brandTag);
        a.appendChild(badge);
        a.appendChild(cta);
        gallery.appendChild(a);
      });

      counter.textContent = `${files.length} item${files.length!==1?'s':''}`;
    }

    loadImagesFromGitHub();
  </script>
</body>
</html>
